<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.sproject.dao.board.PostDao">
<select id="selectListPostOfBoard" parameterType="com.example.sproject.model.board.Post" resultType="com.example.sproject.model.board.Post">
	<![CDATA[
		select *
		from (select rownum rn, a.*
			  from (select * from post order by p_num) a) where rn >= #{start} and rn <= #{end}
	]]>	
</select>

<select id="PostTotalOfBoard" resultType="int">
		select Count(*) FROM post	
	</select>
  <insert id="PostInsertOfBoard" parameterType="com.example.sproject.model.board.Post">
	INSERT INTO post (p_num, m_id, p_name, p_content,p_view) VALUES (
	(SELECT NVL(MAX(p_num)+1, 1) FROM post), #{m_id}, #{p_name}, #{p_content},0)
   </insert>
<!--  게시물 상세조회 -->
    <select id="PostReadOfBoard" parameterType="int" resultType="com.example.sproject.model.board.Post">
        SELECT * FROM post
        WHERE p_num = #{p_num}
    </select>
        <!-- 게시글 조회수 증가처리 -->
    <update id="PostincreaseViewcntOfBoard" parameterType="int">
        UPDATE post SET p_view = p_view + 1 
        WHERE p_num = #{p_num}
    </update>
      <!-- 05. 게시글 수정처리 -->
    <update id="PostUpdateOfBoard">
        UPDATE post SET
            p_name = #{p_name},
            p_content = #{p_content},
            m_id = #{m_id}
        WHERE p_num = #{p_num}
    </update>
    <delete id="PostDeleteOfBoard">
    delete from post where p_num = #{p_num}
    </delete>
     <delete id="PostLikeDeleteOfBoard">
    delete from post_like where p_num = #{p_num}
    </delete>
<!--     게시판 리스트  -->

<select id="selectListBoardofBoard" parameterType="com.example.sproject.model.board.Board" resultType="com.example.sproject.model.board.Board">
		select *
		from board order by bd_ref, bd_order, bd_depth
</select>
<!--     댓글 리스트  -->
<select id="ReplyListofBoard" parameterType="int" resultType="com.example.sproject.model.board.Reply">
		select *
		from reply 
		where p_num = #{p_num}
		order by rp_ref, rp_order, rp_depth
</select>
<!-- 댓글 추가 -->
  <insert id="ReplyInsertOfBoard" parameterType="com.example.sproject.model.board.Reply">
	INSERT INTO REPLY (p_num, rp_num, m_id, rp_content, rp_ref, rp_order, rp_depth )
	VALUES (#{p_num}, #{rp_num}, #{m_id}, #{rp_content}, #{rp_ref},#{rp_order}, #{rp_depth})
   </insert>
   
<!--    댓글 추가를 위해 가장 큰 댓글 번호 가져오기 -->
   <select id="selectOneMaxRp_num" resultType="int">
   	SELECT MAX(rp_num) FROM reply
   </select>
 <delete id="Reply_DeleteOfBoard" parameterType="int">
    delete from reply where rp_num= #{rp_num}
    </delete>
 </mapper>